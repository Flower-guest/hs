var B=Object.defineProperty;var D=(r,e,t)=>e in r?B(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var i=(r,e,t)=>(D(r,typeof e!="symbol"?e+"":e,t),t);import{R as g,d as O,w as _,o as x,f as E,h as S}from"./index-fe294605.js";const l=window.TMap;class G{constructor(e,t){i(this,"marker");i(this,"map");i(this,"geometries");this.map=e,this.geometries=[],this.initMarkerData(t)}initMarkerData(e){if(this.marker=new l.MultiMarker({id:(e==null?void 0:e.markerLayerId)??"marker-layer",map:this.map}),e)for(const t in e)this.update(e[t]);this.geometries=this.marker.geometries}update(e){const t=e.name||e.id;this.marker.styles.hasOwnProperty(t)||this.setStyle(e,t),this.marker.updateGeometries([{...e,position:new l.LatLng(e.position[1],e.position[0]),content:e.name.length>7?e.name.substring(0,7)+"...":e.name}])}setStyle(e,t){const s=this.marker.styles.default,n={anchor:{x:17,y:23},size:18,direction:"bottom",offset:{x:0,y:0},strokeColor:"#65BBE0",strokeWidth:100,...e},a=new l.MarkerStyle({src:g(e==null?void 0:e.icon)??s.src,width:42,height:48,color:"#fff",...n});this.marker.styles[t]=a}remove(e){e&&(this.marker.remove([e]),this.geometries=this.marker.geometries)}reset(){this.marker&&this.marker.setMap(null),this.marker=null,this.geometries=[]}}const I=window.TMap;class v extends I.DOMOverlay{constructor(t){super(t);i(this,"content");i(this,"map");i(this,"position");this.map=t.map,this.content=t.content,this.position=t.position}onInit(t){this.content=t.content,this.position=t.position}onDestroy(){this.dom.removeEventListener("touchend",this.onTouchend),this.dom.removeEventListener("click",this.onClick),this.removeAllListeners()}onClick(){this.emit("click")}onTouchend(){this.emit("touchend")}createDOM(){const t=document.createElement("div");return t.classList.add("clusterBubble"),t.innerText=this.content,t.style.cssText=["width: 46px;","height: 52px;","line-height: 46px;"].join(" "),this.onClick=this.onClick.bind(this),t.addEventListener("click",this.onClick),this.onTouchend=this.onTouchend.bind(this),t.addEventListener("touchend",this.onTouchend),t}updateDOM(){if(!this.map)return;const t=this.map.projectToContainer(this.position),s=t.getX()-this.dom.clientWidth/2+"px",n=t.getY()-this.dom.clientHeight/2+"px";this.dom.style.transform=`translate(${s}, ${n})`,this.emit("dom_updated")}}const k=window.TMap;class z{constructor(e,t){i(this,"markerCluster");i(this,"map");i(this,"geometries");i(this,"clusterBubbleList");i(this,"markerGeometries");i(this,"marker");this.map=e,this.marker=t,this.geometries=[],this.clusterBubbleList=[],this.markerGeometries=[],this.initMarkerData(t.geometries)}initMarkerData(e){for(const t in e)this.geometries.push({...e[t],position:new k.LatLng(e[t].position.lat,e[t].position.lng)});this.markerCluster=new k.MarkerCluster({id:"markerCluster-layer",map:this.map,geometries:this.geometries,enableDefaultStyle:!1,minimumClusterSize:3,zoomOnClick:!0,gridSize:90,averageCenter:!1}),this.markerCluster.on("cluster_changed",()=>{this.clusterBubbleList.length&&(this.clusterBubbleList.forEach(function(s){s.destroy()}),this.clusterBubbleList=[]),this.markerGeometries=[],this.markerCluster.getClusters().forEach(s=>{if(s.geometries.length>2){const n=new v({map:this.map,position:s.center,content:s.geometries.length});n.on("click",()=>{this.map.fitBounds(s.bounds)}),n.on("touchend",()=>{this.map.fitBounds(s.bounds)}),this.clusterBubbleList.push(n)}else this.markerGeometries.push({...s.geometries[0],styleId:s.geometries[0].name})}),this.marker.marker.setGeometries(this.markerGeometries)})}reset(){this.markerCluster&&this.markerCluster.setMap(null),this.markerCluster=null,this.clusterBubbleList.forEach(e=>{e.setMap(null)}),this.clusterBubbleList=[],this.geometries=[],this.marker=null,this.markerGeometries=[]}}const m={};function $(r,e){const t=new G(r,e??""),s=new z(r,t??"");return m.marker=t,m.markerCluster=s,m}const A=r=>{r.marker.reset(),r.markerCluster.reset()},N={class:"w-screen h-screen",id:"container"},P=O({__name:"Map",props:{marker:{}},emits:["markerHandel"],setup(r,{expose:e,emit:t}){const s=r,n=t,a=window.TMap;let c,h;_(()=>s.marker,o=>{p(),u(o),console.log(o)});const b=async()=>{c=new a.Map("container",{zoom:17,center:new a.LatLng(28.80357875,111.91394806),renderOptions:{enableBloom:!0},baseMap:{type:"vector",features:["base","point","label","arrow","building"]},viewMode:"2D"}),c.removeControl(a.constants.DEFAULT_CONTROL_ID.ZOOM),c.removeControl(a.constants.DEFAULT_CONTROL_ID.ROTATION);const o=`url(${g("logo.ico")}),auto`;c.setCursorStyle(o),window.map=c,u("")},{business:M,travel:f,industry:w,mining:C,other:y}=window.data.marker,L=[...M,...f,...w,...C,...y],u=o=>{window.searchList=o||L,h=$(c,o||window.searchList);const{marker:d}=h;d.marker.on("click",function(T){n("markerHandel",T.geometry)})},p=()=>{A(h)};return x(()=>{b()}),e({resetMapData:p}),(o,d)=>(E(),S("div",N))}});export{P as _};
