var S=Object.defineProperty;var O=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>(O(r,typeof e!="symbol"?e+"":e,t),t);import{R as d,d as _,w as x,o as G,f as I,h as N,aU as z}from"./index-bc6f3eb8.js";const l=window.TMap;class W{constructor(e,t){n(this,"marker");n(this,"map");n(this,"geometries");this.map=e,this.geometries=[],this.initMarkerData(t)}initMarkerData(e){if(this.marker=new l.MultiMarker({id:(e==null?void 0:e.markerLayerId)??"marker-layer",map:this.map}),e)for(const t in e)this.update(e[t]);this.geometries=this.marker.geometries}update(e){const t=e.name||e.id;this.marker.styles.hasOwnProperty(t)||this.setStyle(e,t),this.marker.updateGeometries([{...e,position:new l.LatLng(e.position[1],e.position[0]),content:e.name.length>7?e.name.substring(0,7)+"...":e.name}])}setStyle(e,t){const c=this.marker.styles.default,s={anchor:{x:17,y:23},size:18,direction:"bottom",offset:{x:0,y:0},strokeColor:"#65BBE0",strokeWidth:100,...e},i=new l.MarkerStyle({src:d(e==null?void 0:e.icon)??c.src,width:42,height:48,color:"#fff",...s});this.marker.styles[t]=i}remove(e){e&&(this.marker.remove([e]),this.geometries=this.marker.geometries)}reset(){this.marker&&this.marker.setMap(null),this.marker=null,this.geometries=[]}}const v=window.TMap;class $ extends v.DOMOverlay{constructor(t){super(t);n(this,"content");n(this,"map");n(this,"position");this.map=t.map,this.content=t.content,this.position=t.position}onInit(t){this.content=t.content,this.position=t.position}onDestroy(){this.dom.removeEventListener("touchend",this.onTouchend),this.dom.removeEventListener("click",this.onClick),this.removeAllListeners()}onClick(){this.emit("click")}onTouchend(){this.emit("touchend")}createDOM(){const t=document.createElement("div");return t.classList.add("clusterBubble"),t.innerText=this.content,t.style.cssText=["width: 46px;","height: 52px;","line-height: 46px;"].join(" "),this.onClick=this.onClick.bind(this),t.addEventListener("click",this.onClick),this.onTouchend=this.onTouchend.bind(this),t.addEventListener("touchend",this.onTouchend),t}updateDOM(){if(!this.map)return;const t=this.map.projectToContainer(this.position),c=t.getX()-this.dom.clientWidth/2+"px",s=t.getY()-this.dom.clientHeight/2+"px";this.dom.style.transform=`translate(${c}, ${s})`,this.emit("dom_updated")}}const k=window.TMap;class A{constructor(e,t){n(this,"markerCluster");n(this,"map");n(this,"geometries");n(this,"clusterBubbleList");n(this,"markerGeometries");n(this,"marker");this.map=e,this.marker=t,this.geometries=[],this.clusterBubbleList=[],this.markerGeometries=[],this.initMarkerData(t.geometries)}initMarkerData(e){for(const t in e)this.geometries.push({...e[t],position:new k.LatLng(e[t].position.lat,e[t].position.lng)});this.markerCluster=new k.MarkerCluster({id:"markerCluster-layer",map:this.map,geometries:this.geometries,enableDefaultStyle:!1,minimumClusterSize:3,zoomOnClick:!0,gridSize:90,averageCenter:!1}),this.markerCluster.on("cluster_changed",()=>{var c;this.clusterBubbleList.length&&(this.clusterBubbleList.forEach(function(s){s.destroy()}),this.clusterBubbleList=[]),this.markerGeometries=[];const t=(c=this.markerCluster)==null?void 0:c.getClusters();t&&t.forEach(s=>{if(s.geometries.length>2){const i=new $({map:this.map,position:s.center,content:s.geometries.length});i.on("click",()=>{this.map.fitBounds(s.bounds)}),i.on("touchend",()=>{this.map.fitBounds(s.bounds)}),this.clusterBubbleList.push(i)}else this.markerGeometries.push({...s.geometries[0],styleId:s.geometries[0].name})}),this.marker&&this.marker.marker.setGeometries(this.markerGeometries)})}reset(){this.markerCluster&&this.markerCluster.setMap(null),this.markerCluster=null,this.clusterBubbleList.forEach(e=>{e.setMap(null)}),this.clusterBubbleList=[],this.geometries=[],this.marker=null,this.markerGeometries=[]}}const u={};function H(r,e){const t=new W(r,e??""),c=new A(r,t??"");return u.marker=t,u.markerCluster=c,u}const P=r=>{r.marker.reset(),r.markerCluster.reset()},R={class:"w-screen h-screen",id:"container"},F=_({__name:"Map",props:{marker:{},type:{default:"resource"}},emits:["markerHandel"],setup(r,{emit:e}){const t=r,c=e,s=window.TMap;let i,m;const w={resource:{center:[28.895863,111.879582],zoom:11,img:"handDrawing/resource.png",imageSW:[28.607333019835735,111.68350178930609],imageNE:[29.14713394652845,112.31232510576615]},specialTrain:{center:[28.789483,111.928793],zoom:14.5,img:"handDrawing/park.png",imageSW:[28.762054577351662,111.9080378373178],imageNE:[28.805162279243536,111.9734938866169]}};x(()=>t.marker,o=>{D(),p(o),g(t.type)});const L=async()=>{window.map=i=new s.Map("container",{renderOptions:{enableBloom:!0},baseMap:{type:"vector",features:["base","point","label","arrow","building"]},mapStyleId:"style1",viewMode:"2D"}),i.removeControl(s.constants.DEFAULT_CONTROL_ID.ZOOM),i.removeControl(s.constants.DEFAULT_CONTROL_ID.ROTATION);const o=`url(${d("logo.ico")}),auto`;i.setCursorStyle(o),z()&&g(),p("")},{business:b,travel:M,industry:f,mining:y,other:C}=window.data.marker,T=[...b,...M,...f,...y,...C],p=o=>{window.searchList=o||T,m=H(i,o||window.searchList);const{marker:a}=m;a.marker.on("click",function(h){c("markerHandel",h.geometry)})},g=(o="resource")=>{window.imageGroundLayer=null,o=o==="specialTrain"?o:"resource";const a=w[o],h=new s.LatLng(a.imageSW[0],a.imageSW[1]),B=new s.LatLng(a.imageNE[0],a.imageNE[1]),E=new s.LatLngBounds(h,B);window.imageGroundLayer=new s.ImageGroundLayer({map:i,src:d(a.img),bounds:E}),i.setCenter(new s.LatLng(a.center[0],a.center[1])),i.setZoom(a.zoom)},D=()=>{P(m)};return G(()=>{L()}),(o,a)=>(I(),N("div",R))}});export{F as _};
