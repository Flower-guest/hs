var S=Object.defineProperty;var O=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>(O(r,typeof e!="symbol"?e+"":e,t),t);import{R as m,d as _,w as x,o as G,f as N,h as I,aU as z}from"./index-d8eb75d6.js";const u=window.TMap;class W{constructor(e,t){o(this,"marker");o(this,"map");o(this,"geometries");this.map=e,this.geometries=[],this.initMarkerData(t)}initMarkerData(e){if(this.marker=new u.MultiMarker({id:(e==null?void 0:e.markerLayerId)??"marker-layer",map:this.map}),e)for(const t in e)this.update(e[t]);this.geometries=this.marker.geometries}update(e){const t=e.name||e.id;this.marker.styles.hasOwnProperty(t)||this.setStyle(e,t),this.marker.updateGeometries([{...e,position:new u.LatLng(e.position[1],e.position[0]),content:e.name.length>7?e.name.substring(0,7)+"...":e.name}])}setStyle(e,t){const c=this.marker.styles.default,s={anchor:{x:17,y:23},size:18,direction:"bottom",offset:{x:0,y:0},strokeColor:"#65BBE0",strokeWidth:100,...e},i=new u.MarkerStyle({src:m(e==null?void 0:e.icon)??c.src,width:42,height:48,color:"#fff",...s});this.marker.styles[t]=i}remove(e){e&&(this.marker.remove([e]),this.geometries=this.marker.geometries)}reset(){this.marker&&this.marker.setMap(null),this.marker=null,this.geometries=[]}}const v=window.TMap;class $ extends v.DOMOverlay{constructor(t){super(t);o(this,"content");o(this,"map");o(this,"position");this.map=t.map,this.content=t.content,this.position=t.position}onInit(t){this.content=t.content,this.position=t.position}onDestroy(){this.dom.removeEventListener("touchend",this.onTouchend),this.dom.removeEventListener("click",this.onClick),this.removeAllListeners()}onClick(){this.emit("click")}onTouchend(){this.emit("touchend")}createDOM(){const t=document.createElement("div");return t.classList.add("clusterBubble"),t.innerText=this.content,t.style.cssText=["width: 46px;","height: 52px;","line-height: 46px;"].join(" "),this.onClick=this.onClick.bind(this),t.addEventListener("click",this.onClick),this.onTouchend=this.onTouchend.bind(this),t.addEventListener("touchend",this.onTouchend),t}updateDOM(){if(!this.map)return;const t=this.map.projectToContainer(this.position),c=t.getX()-this.dom.clientWidth/2+"px",s=t.getY()-this.dom.clientHeight/2+"px";this.dom.style.transform=`translate(${c}, ${s})`,this.emit("dom_updated")}}const w=window.TMap;class A{constructor(e,t){o(this,"markerCluster");o(this,"map");o(this,"geometries");o(this,"clusterBubbleList");o(this,"markerGeometries");o(this,"marker");this.map=e,this.marker=t,this.geometries=[],this.clusterBubbleList=[],this.markerGeometries=[],this.initMarkerData(t.geometries)}initMarkerData(e){for(const t in e)this.geometries.push({...e[t],position:new w.LatLng(e[t].position.lat,e[t].position.lng)});this.markerCluster=new w.MarkerCluster({id:"markerCluster-layer",map:this.map,geometries:this.geometries,enableDefaultStyle:!1,minimumClusterSize:3,zoomOnClick:!0,gridSize:90,averageCenter:!1}),this.markerCluster.on("cluster_changed",()=>{var c;this.clusterBubbleList.length&&(this.clusterBubbleList.forEach(function(s){s.destroy()}),this.clusterBubbleList=[]),this.markerGeometries=[];const t=(c=this.markerCluster)==null?void 0:c.getClusters();t&&t.forEach(s=>{if(s.geometries.length>2){const i=new $({map:this.map,position:s.center,content:s.geometries.length});i.on("click",()=>{this.map.fitBounds(s.bounds)}),i.on("touchend",()=>{this.map.fitBounds(s.bounds)}),this.clusterBubbleList.push(i)}else this.markerGeometries.push({...s.geometries[0],styleId:s.geometries[0].name})}),this.marker&&this.marker.marker.setGeometries(this.markerGeometries)})}reset(){this.markerCluster&&this.markerCluster.setMap(null),this.markerCluster=null,this.clusterBubbleList.forEach(e=>{e.setMap(null)}),this.clusterBubbleList=[],this.geometries=[],this.marker=null,this.markerGeometries=[]}}const d={};function H(r,e){const t=new W(r,e??""),c=new A(r,t??"");return d.marker=t,d.markerCluster=c,d}const P=r=>{r.marker.reset(),r.markerCluster.reset()},R={class:"w-screen h-screen",id:"container"},F=_({__name:"Map",props:{marker:{},type:{default:"resource"}},emits:["markerHandel"],setup(r,{emit:e}){const t=r,c=e,s=window.TMap;let i,h;const L={resource:{center:[28.895863,111.879582],zoom:11,img:"handDrawing/resource.png",imageSW:[28.607333019835735,111.68350178930609],imageNE:[29.14713394652845,112.31232510576615]},specialTrain:{center:[28.789483,111.928793],zoom:14.5,img:"handDrawing/park.png",imageSW:[28.762054577351662,111.9080378373178],imageNE:[28.805162279243536,111.9734938866169]}};x(()=>t.marker,a=>{D(),p(a),g(t.type)});const b=async()=>{i=new s.Map("container",{renderOptions:{enableBloom:!0},baseMap:{type:"vector",features:["base","point","label","arrow","building"]},viewMode:"2D"}),i.removeControl(s.constants.DEFAULT_CONTROL_ID.ZOOM),i.removeControl(s.constants.DEFAULT_CONTROL_ID.ROTATION);const a=`url(${m("logo.ico")}),auto`;i.setCursorStyle(a),z()&&g(),p("")},{business:f,travel:M,industry:y,mining:C,other:T}=window.data.marker,B=[...f,...M,...y,...C,...T],p=a=>{window.searchList=a||B,h=H(i,a||window.searchList);const{marker:n}=h;n.marker.on("click",function(l){c("markerHandel",l.geometry)})},g=(a="resource")=>{a=a==="specialTrain"?a:"resource";const n=L[a],l=new s.LatLng(n.imageSW[0],n.imageSW[1]),E=new s.LatLng(n.imageNE[0],n.imageNE[1]),k=new s.LatLngBounds(l,E);window.imageGroundLayer?(console.log(m(n.img)),window.imageGroundLayer.setSrc(m(n.img)),window.imageGroundLayer.setBounds(k)):window.imageGroundLayer=new s.ImageGroundLayer({map:i,src:m(n.img),bounds:k}),i.setCenter(new s.LatLng(n.center[0],n.center[1])),i.setZoom(n.zoom)},D=()=>{P(h)};return G(()=>{b()}),(a,n)=>(N(),I("div",R))}});export{F as _};
